@model IList<JEDCMobilityManager.Utility.Area>
@{
    ViewData["Title"] = "Home Page";
}

@section head {
    <link href="https://unpkg.com/maplibre-gl/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/maplibre-gl/dist/maplibre-gl.js"></script>
    <script>
        customElements.define("x-map", (function (proto) {
            constructor.prototype = Object.create(proto.prototype, {
                latitude: { get: function () { return parseFloat(this.getAttribute("latitude")) || 0; } },
                longitude: { get: function () { return parseFloat(this.getAttribute("longitude")) || 0; } },
                zoom: { get: function(){ return parseFloat(this.getAttribute("zoom")) || 5; } },
                constructor: { value: constructor },
                connectedCallback: { value: function () {
                    setTimeout(function () {
                        console.log(this.querySelector("template"));
                    }.bind(this));
                    this.map = new maplibregl.Map({
                        container: this,
                        style: "https://demotiles.maplibre.org/style.json",
                        center: [this.longitude, this.latitude],
                        zoom: this.zoom
                    });
                    this.map.addControl(new maplibregl.NavigationControl());
                } }
            });
            return constructor;

            function constructor() {
                return Reflect.construct(proto, [], constructor);
            }
        })(HTMLElement));
    </script>
}

<x-map style="height: 500px; width: 500px; resize: both;  display: block;" latitude="58.3005" longitude="-134.4201" zoom="14">
    <template>
        <caption>Ranger Districts</caption>
        @foreach (var area in Model)
        {
            <tr>
                <th>@area.Name</th>
                <td>@area.GeoJson</td>
            </tr>
        }
    </template>
</x-map>
